# Consuming Muon Services

Muon is all of :-

 * A set of concepts and ideas
 * A set of libraries
 * A A set of network protocols

If you have an existing Muon service, and you want to interact with it, then you have to use all of these things in order to do so.

The easiest way to do that is to use an existing Muon library and connect.

## The Muon CLI

The Muon Node CLI is a thin wrapper around the NodeJS implementation of Muon and can be easily installed and used to interacty with a set of Muon Microservices

## Building a Muon Client

Building a client or peer service that communicates with a Muon based Microservice is straightforward.

Using NodeJS, you can create a peer service by creating a new Node/ NPM project (as in the Getting Started guide), but with a different service.

Here is a service that will connect to the service defined in the Getting Started guide.

```
var muonCore = require("muon-core");
var sleep = require('sleep');

var amqp = muonCore.amqpTransport("amqp://localhost");

var muonClient = muonCore.muon('node-client', amqp.getDiscovery(), [
    "my-tag", "tck-service", "node-service"
]);

muonClient.addTransport(amqp);

setTimeout(function() {

    muonClient.resource.query("muon://node-server/query", function(event, payload) {
            console.log("event received...");
            console.log(payload);
        });
    
},3500);
```

You may combine these into a service that will expose an endpoint and connect to another service.

```
var muonCore = require("muon-core");
var sleep = require('sleep');

var amqp = muonCore.amqpTransport("amqp://localhost");

var muonClient = muonCore.muon('node-client', amqp.getDiscovery(), [
    "my-tag", "tck-service", "node-service"
]);

muonClient.addTransport(amqp);

setTimeout(function() {
    muonServer.resource.onQuery("/query", "Get the events", function(event, data, respond) {
        muonClient.resource.query("muon://node-server/query", function(event, payload) {
            console.log("event received...");
            console.log(payload);
            respond({"echo":"this is the server response"});
        });
    });
},3500);
```

You may querytest this new service using the cli

```
muon -d local query muon://muon-client/query
{ echo: 'this is the server response' }
```
