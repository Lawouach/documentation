
# Getting Started with Muon

Muon is a set of libraries for building rich, event oriented, polyglot Microservices easily and quickly.

Muon is designed to allow the creation of a variety of DDD concepts, and uses events to communicate between your microservices.  Multiple languages are supported via the libraries, and a rich set of communication types are supported, request/ response (implementing CQRS), event broadcast and Reactive Streaming with back pressure.

These concepts are exposed to users via language idiomatic APIs, and form a programming model for microservices that is semantically rich, performant and of a very different nature from the synchronous HTTP that many microservice based systems use.

This is built upon a variety of network transports that take the Muon concepts and move them over the network. These take a variety of forms that have different characteristics. Some examples are AMQP, HTTP and ZeroMQ.

TODO, picture showing the three layer nature.

## Your first service

We will use the NodeJS library to build your first Muon service.

### Setup RabbitMQ

First, install a RabbitMQ server. This will be used to allow services to locate each other (discovery) and also provide a communication channel.  Once you have installed a RabbitMQ broker, move onto the next step.

RabbitMQ/ AMQP is one transport option for Muon, but is not required. It is used in these examples as can also double as a convenient development time discovery mechanism. In production setups you may use another option, such as ETCD or Consul.

### Install the Muon CL

Install the NodeJS Muon CLI. This can be used to discover, inspect and interact with Muon based services.

```
npm -g install muon-core
```

Create a CLI discovery setup 
```
muon setup
```

This creates a file in your home directory /.muon/discovery.json that will default to expecting an AMQP/ RabbitMQ server on the local machine.

### Setup the Node Project

Create a new node project by creating a new directory called 'myservice', then editing package.json

```
{
  "name": "muon-exmaples",
  "description": "node.js muon example",
  "version": "0.1.0",
  "author": "Simplicity Itself Ltd",
  "keywords": [
    "muon",
    "microservices",
    "antifragile"
  ],
  "dependencies": {
    "muon-core": "36.0.0-0",
    "sleep": "*"
  },
  "devDependencies": {
    "assert": "*"
  },
  "engines": {
    "node": "*"
  }
}
```

run 

```
npm install 
```

In this directory to install the project dependencies.

### Create a Muon Microservice

Now, we can create a new microservice.

Create a new file 'myservice.js'
```
var muonCore = require("muon-core");

var amqp = muonCore.amqpTransport("amqp://localhost");

var muonServer = muonCore.muon('node-server', amqp.getDiscovery(), [
    ["my-tag", "tck-service", "node-service"]
]);

muonServer.addTransport(amqp);

setTimeout(function() {
    muonServer.resource.onQuery("/query", "Get the events", function(event, data, respond) {
        respond({"echo":"this is the server response"});
    });
},3500);
```

### Testing the Service

Start the service up

```
node myservice.js
```

In a seperate terminal, use the cli to discover the service, and also query it

```
muon -d local discover
...

muon -d local query muon://node-service/query
...
```

## Next Steps

* (Consuming services)[Consuming Services.adoc]
* Using CQRS
* Using event broadcasting
* Using Reactive Streams
* Event Sourcing using the Photon Event Store
* Extending Muon
* Building a new implementation of Muon.
